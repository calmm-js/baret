!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("react"),require("baconjs"),require("infestines")):"function"==typeof define&&define.amd?define(["exports","react","baconjs","infestines"],n):n(r.baret={},r.React,r.Bacon,r.I)}(this,function(r,n,e,t){"use strict";function i(r,n,e){if(U(r))return e[++n[0]];if(t.isArray(r)){for(var s=r,u=0,a=r.length;u<a;++u){var l=r[u],o=l;U(l)?o=e[++n[0]]:t.isArray(l)&&(o=i(l,n,e)),o!==l&&(s===r&&(s=r.slice(0)),s[u]=o)}return s}return r}function s(r,n,e){var t=void 0;for(var i in r){var s=r[i];if(U(s)){if(!t){t={};for(var u in r){if(u===i)break;t[u]=r[u]}}t[i]=e[++n[0]]}else t&&(t[i]=s)}return t||r}function u(r,n){var e=null,t=null,u=null,a=[-1];for(var l in r){var o=r[l];p===l?u=i(o,a,n):"$$type"===l?e=r[l]:m===l?(t=t||{}).ref=U(o)?n[++a[0]]:o:U(o)?(t=t||{})[l]=n[++a[0]]:b===l?(t=t||{}).style=s(o,a,n)||o:(t=t||{})[l]=o}return u instanceof Array?A.apply(null,[e,t].concat(u)):null!==u?A(e,t,u):A(e,t)}function a(r,n,e){for(var i=0,s=r.length;i<s;++i){var u=r[i];U(u)?e(n,u):t.isArray(u)&&a(u,n,e)}}function l(r,n,e){for(var i in r){var s=r[i];if(U(s))e(n,s);else if(p===i)t.isArray(s)&&a(s,n,e);else if(b===i)for(var u in s){var l=s[u];U(l)&&e(n,l)}}}function o(r){r.values+=1}function f(r,n){r.unsub=n.subscribe(r)}function c(r,n){var e=function n(e){for(var t=r.handlers,i=0;t[i]!==n;)++i;if(e.hasValue()){var s=e.value(),u=r.values;u[i]!==s&&(u[i]=s,r.forceUpdate())}else{if(e.isError())throw e.error;t[i]=null;var a=t.length;if(a!==r.values.length)return;for(var l=0;l<a;++l)if(t[l])return;r.handlers=null}};r.handlers.push(e),e.unsub=n.subscribe(e)}function h(r){r&&r.unsub()}function v(r,n){for(var e=n.length;r<e;++r){var i=n[r];if(U(i)||t.isArray(i)&&v(0,i))return!0}return!1}function d(r,n){var e={$$type:r};for(var t in n){var i=n[t];"ref"===t?e[m]=i:y!==t&&(e[t]=i)}return e}var b="style",p="children",y="baret-lift",m="$$ref",A=(n=n&&n.hasOwnProperty("default")?n.default:n).createElement,g=n.Component,U=function(r){return r instanceof e.Observable},E=t.inherit(function(r){g.call(this,r)},g,{componentWillReceiveProps:function(r){this.componentWillUnmount(),this.doSubscribe(r)},componentWillMount:function(){this.doSubscribe(this.props)}}),j=t.inherit(function(r){E.call(this,r),this.callback=null,this.rendered=null},E,{componentWillUnmount:function(){this.unsub&&this.unsub()},doSubscribe:function(r){var n=this,e=r.observable;if(U(e)){this.unsub=e.subscribe(function(r){if(r.hasValue())n.rendered=r.value()||null,n.forceUpdate();else{if(r.isError())throw r.error;r.isEnd()&&(n.unsub=null)}})}else this.rendered=e||null},render:function(){return this.rendered}}),$=t.inherit(function(r){E.call(this,r),this.values=this,this.handlers=null},E,{componentWillUnmount:function(){var r=this.handlers;r instanceof Function?r.unsub():r&&r.forEach(h)},doSubscribe:function(r){var n=this;this.values=0,l(r,this,o);var e=this.values;switch(e){case 0:this.values=t.array0;break;case 1:this.values=this;var i=function(r){if(r.hasValue()){var e=r.value();n.values!==e&&(n.values=e,n.forceUpdate())}else{if(r.isError())throw r.error;n.values=[n.values],n.handlers=null}};this.handlers=i,l(r,i,f);break;default:this.values=Array(e).fill(this),this.handlers=[],l(r,this,c)}},render:function(){if(this.handlers instanceof Function){var r=this.values;return r===this?null:u(this.props,[r])}for(var n=this.values,e=0,t=n.length;e<t;++e)if(n[e]===this)return null;return u(this.props,n)}}),w=t.assocPartialU("createElement",function(){for(var r=arguments.length,n=Array(r),e=0;e<r;e++)n[e]=arguments[e];var i=n[0],s=n[1]||t.object0;return(t.isString(i)||s[y])&&(v(2,n)||function(r){for(var n in r){var e=r[n];if(U(e))return!0;if(p===n){if(t.isArray(e)&&v(0,e))return!0}else if(b===n)for(var i in e)if(U(e[i]))return!0}return!1}(s)?(n[1]=d(i,s),n[0]=$):s[y]&&(n[1]=t.dissocPartialU(y,s)||t.object0)),A.apply(void 0,n)},n);r.fromBacon=function(r){return A(j,{observable:r})},r.default=w,r.fromClass=function(r){return function(n){return A($,d(r,n))}},Object.defineProperty(r,"__esModule",{value:!0})});
