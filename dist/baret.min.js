!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("react"),require("baconjs"),require("infestines")):"function"==typeof define&&define.amd?define(["exports","react","baconjs","infestines"],n):n(r.baret={},r.React,r.Bacon,r.I)}(this,function(r,n,e,t){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var i="default"in e?e.default:e,u="style",s="children",a="baret-lift",o="$$ref",l=n.createElement,f=n.Component,c=function(r){return r instanceof e.Observable},h="function"!=typeof i.Next().value?function(r){return r.value}:function(r){return r.value()},v=t.inherit(function(r){f.call(this,r)},f,{componentWillReceiveProps:function(r){this.componentWillUnmount(),this.doSubscribe(r)},componentWillMount:function(){this.doSubscribe(this.props)}}),d=t.inherit(function(r){v.call(this,r),this.callback=null,this.rendered=null},v,{componentWillUnmount:function(){this.unsub&&this.unsub()},doSubscribe:function(r){var n=this,e=r.observable;if(c(e)){this.unsub=e.subscribe(function(r){if(r.hasValue())n.rendered=h(r)||null,n.forceUpdate();else{if(r.isError())throw r.error;r.isEnd()&&(n.unsub=null)}})}else this.rendered=e||null},render:function(){return this.rendered}});function b(r,n,e){if(c(r))return e[++n[0]];if(t.isArray(r)){for(var i=r,u=0,s=r.length;u<s;++u){var a=r[u],o=a;c(a)?o=e[++n[0]]:t.isArray(a)&&(o=b(a,n,e)),o!==a&&(i===r&&(i=r.slice(0)),i[u]=o)}return i}return r}function p(r,n,e){var t=void 0;for(var i in r){var u=r[i];if(c(u)){if(!t)for(var s in t={},r){if(s===i)break;t[s]=r[s]}t[i]=e[++n[0]]}else t&&(t[i]=u)}return t||r}function y(r,n){var e=null,t=null,i=null,a=[-1];for(var f in r){var h=r[f];s===f?i=b(h,a,n):"$$type"===f?e=r[f]:o===f?(t=t||{}).ref=c(h)?n[++a[0]]:h:c(h)?(t=t||{})[f]=n[++a[0]]:u===f?(t=t||{}).style=p(h,a,n)||h:(t=t||{})[f]=h}return i instanceof Array?l.apply(null,[e,t].concat(i)):null!==i?l(e,t,i):l(e,t)}function m(r,n,e){for(var i=0,u=r.length;i<u;++i){var s=r[i];c(s)?e(n,s):t.isArray(s)&&m(s,n,e)}}function A(r,n,e){for(var i in r){var a=r[i];if(c(a))e(n,a);else if(s===i)t.isArray(a)&&m(a,n,e);else if(u===i)for(var o in a){var l=a[o];c(l)&&e(n,l)}}}function g(r){r.values+=1}function U(r,n){r.unsub=n.subscribe(r)}function E(r,n){var e=function n(e){for(var t=r.handlers,i=0;t[i]!==n;)++i;if(e.hasValue()){var u=h(e),s=r.values;s[i]!==u&&(s[i]=u,r.forceUpdate())}else{if(e.isError())throw e.error;t[i]=null;var a=t.length;if(a!==r.values.length)return;for(var o=0;o<a;++o)if(t[o])return;r.handlers=null}};r.handlers.push(e),e.unsub=n.subscribe(e)}function j(r){r&&r.unsub()}var $=t.inherit(function(r){v.call(this,r),this.values=this,this.handlers=null},v,{componentWillUnmount:function(){var r=this.handlers;r instanceof Function?r.unsub():r&&r.forEach(j)},doSubscribe:function(r){var n=this;this.values=0,A(r,this,g);var e=this.values;switch(e){case 0:this.values=t.array0;break;case 1:this.values=this;var i=function(r){if(r.hasValue()){var e=h(r);n.values!==e&&(n.values=e,n.forceUpdate())}else{if(r.isError())throw r.error;n.values=[n.values],n.handlers=null}};this.handlers=i,A(r,i,U);break;default:this.values=Array(e).fill(this),this.handlers=[],A(r,this,E)}},render:function(){if(this.handlers instanceof Function){var r=this.values;return r===this?null:y(this.props,[r])}for(var n=this.values,e=0,t=n.length;e<t;++e)if(n[e]===this)return null;return y(this.props,n)}});function w(r,n){for(var e=n.length;r<e;++r){var i=n[r];if(c(i)||t.isArray(i)&&w(0,i))return!0}return!1}function P(r,n){var e={$$type:r};for(var t in n){var i=n[t];"ref"===t?e[o]=i:a!==t&&(e[t]=i)}return e}var S=t.assocPartialU("createElement",function(){for(var r=arguments.length,n=Array(r),e=0;e<r;e++)n[e]=arguments[e];var i=n[0],o=n[1]||t.object0;return(t.isString(i)||o[a])&&(w(2,n)||function(r){for(var n in r){var e=r[n];if(c(e))return!0;if(s===n){if(t.isArray(e)&&w(0,e))return!0}else if(u===n)for(var i in e)if(c(e[i]))return!0}return!1}(o)?(n[1]=P(i,o),n[0]=$):o[a]&&(n[1]=t.dissocPartialU(a,o)||t.object0)),l.apply(void 0,n)},n);r.fromBacon=function(r){return l(d,{observable:r})},r.default=S,r.fromClass=function(r){return function(n){return l($,P(r,n))}},Object.defineProperty(r,"__esModule",{value:!0})});
